<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIPS - Allama Iqbal Public School</title>
  <link rel="stylesheet" href="Styles.css">
  <link rel="stylesheet" href="Responsive.css">
  <link rel="stylesheet" href="Other.css">
  <link rel="icon" href="Photoes/School Logo.png" type="image/png">
</head>
<body>

  <!-- =================== Top Bar =================== -->
  <div class="top-bar">
    <div class="contact-info">
      <h1>Mr. Zafar Iqbal (Director)</h1>
    </div>
    <button class="hamburger" id="portal-hamburger">&#9776;</button>
  </div>

  <!-- =================== Portal Sidebar =================== -->
  <div class="portal-sidebar" id="portal-sidebar">
    <a href="teacher_dash.html">HOME</a>
    <a href="https://forms.gle/TkW5rBBm5pMx1kwp9" onclick="teacherLogout()">REPORT</a>
    <a href="T_att.html">ATTENDANCE</a>
    <a href="https://drive.google.com/drive/folders/1hK3dk3VHyIlaujTZi7t2MjAo6Ck4juXc?usp=sharing">E-LIBRARY</a>
    <button class="admissions-btn" onclick="teacherLogout()">LOGOUT</button>
  </div>

  <!-- =================== Header =================== -->
  <div class="header">
    <a>
      <img src="https://raw.githubusercontent.com/hasham14fw/AIPS-/refs/heads/main/public/Photoes/School%20Logo.png" alt="Logo" width="90" height="90">
    </a>
    <div class="school-name">
      <div>ALLAMA IQBAL PUBLIC SCHOOL</div>
      <div>(M.P.M) HASILPUR</div>
    </div>
    <nav>
      <a href="teacher_dash.html">HOME</a>
      <a href="https://forms.gle/TkW5rBBm5pMx1kwp9" onclick="teacherLogout()">REPORT</a>
      <a href="T_att.html">ATTENDANCE</a>
      <a href="https://drive.google.com/drive/folders/1hK3dk3VHyIlaujTZi7t2MjAo6Ck4juXc?usp=sharing">E-LIBRARY</a>
      <button class="admissions-btn" id="logoutBtnSide" onclick="teacherLogout()">LOGOUT</button>
    </nav>
  </div>

  <!-- =================== Attendance Section =================== -->
  <div class="attendance-container">
    <h2>Mark Attendance</h2>
    <table>
      <thead>
        <tr>
          <th>Reg #</th>
          <th>Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="attendance-table-body"></tbody>
    </table>
    <button id="submitAttendanceBtn">Submit Attendance</button>
    <p id="attendance-message"></p> <!-- ✅ Message area -->
  </div>

  <!-- =================== Footer =================== -->
  <footer class="footer">
    <div class="footer-content">
      <p>Contact Us</p>
      <ul class="footer-links">
        <li><a href="tel:+923057936514"><img src="Photoes/Call-Icon.png" alt="Call" width="30" height="30"></a></li>
        <li><a href="mailto:zafar.iqbal.aips@gmail.com"><img src="Photoes/Mail-Icon.png" alt="Mail" width="30" height="30"></a></li>
        <li><a href="https://www.facebook.com/AllamaIqbalPublicSchools" target="_blank"><img src="Photoes/Facebook-Icon.png" alt="Facebook" width="30" height="30"></a></li>
        <li><a href="https://wa.me/923404402716" target="_blank"><img src="Photoes/Whatsapp-Icon.png" alt="WhatsApp" width="30" height="30"></a></li>
        <li><a href="https://www.instagram.com/allama_iqbal_public_schools?igsh=MXJuanh1OW4ycTZnZw==" target="_blank"><img src="Photoes/Inta-Icon.png" alt="Instagram" width="30" height="30"></a></li>
      </ul>
    </div>
    <div class="footer-dev">
      <p>Developed By : Muhammad Ahmad Hasham</p>
    </div>
  </footer> 

  <!-- =================== Scripts =================== -->
  <script src="Animation.js"></script>
  <script src="result.js"></script>

  <!-- Attendance Script -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("teacherToken");
  const tableBody = document.getElementById("attendance-table-body");
  const submitBtn = document.getElementById("submitAttendanceBtn");

  if (!token) {
    alert("Unauthorized. Please log in again.");
    window.location.href = "teacher_login.html";
    return;
  }

  // ================= Load Students =================
  try {
    const res = await fetch("https://aips-cizk.onrender.com/api/students", {
      headers: { Authorization: `Bearer ${token}` },
    });

    if (!res.ok) throw new Error("Failed to load students");

    const students = await res.json();

    if (!students.length) {
      tableBody.innerHTML = `<tr><td colspan="3">No students found.</td></tr>`;
      return;
    }

    // Render rows
    tableBody.innerHTML = students
      .map(
        (stu) => `
        <tr>
          <td>${stu.reg}</td>
          <td>${stu.name}</td>
          <td><input type="checkbox" name="status-${stu.reg}" checked></td>
        </tr>
      `
      )
      .join("");
  } catch (err) {
    console.error("Error loading students:", err);
    alert("Error loading students. Please try again later.");
  }

  // ================= Submit Attendance =================
  submitBtn.addEventListener("click", async () => {
    const attendance = Array.from(tableBody.querySelectorAll("tr")).map((row) => {
      const reg = row.cells[0].textContent;
      const name = row.cells[1].textContent;
      const status = row.querySelector("input[type='checkbox']").checked;
      return { reg, name, status };
    });

    try {
      const res = await fetch("https://aips-cizk.onrender.com/api/attendance", {
        method: "POST",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ attendance }),
      });

      const data = await res.json();

      if (res.ok) {
        alert(data.message || "✅ Attendance submitted successfully!");
      } else {
        alert("❌ " + (data.error || "Error submitting attendance"));
      }
    } catch (err) {
      console.error("Submit error:", err);
      alert("⚠️ Server error. Try again later.");
    }
  });
});
</script>


</html>
